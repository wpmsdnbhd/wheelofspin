<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wheel Spinner</title>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #f5f5f5;
}

canvas#wheel {
  margin-top: 20px;
  background: #fff;
  border-radius: 50%;
}

button, input {
  padding: 10px;
  font-size: 16px;
  margin-top: 15px;
}

input { width: 150px; }

/* MODAL */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.modal-content {
  background: white;
  padding: 25px;
  border-radius: 12px;
  min-width: 320px;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
}

.close {
  position: absolute;
  top: 10px;
  right: 15px;
  cursor: pointer;
  font-size: 22px;
}

#winnerList {
  position: relative;
  z-index: 2;
  font-size: 16px;
  line-height: 1.6;
}

#confetti {
  position: fixed;
  inset: 0;
  z-index: 998; /* below modal (999), above page */
  pointer-events: none;
}

</style>
</head>

<body>

<h1>ðŸŽ¡ Wheel Spinner</h1>

<canvas id="wheel" width="500" height="500"></canvas><br>

<input type="number" id="winnerCount" value="5" min="1">
<br>
<button onclick="spin()">Spin & Pick Winners</button>

<!-- MODAL -->
<div id="winnerModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">Ã—</span>
    <h2>ðŸŽ‰ Winners ðŸŽ‰</h2>
    <div id="winnerList"></div>
  </div>
</div>

<script>
/* ================= GLOBAL ================= */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const colors = ["#6B705C","#A5A58D","#B7B7A4","#CB997E"];

let names = [];
let wheelNames = [];
let winners = [];
let angle = 0;

/* ================= LOAD NAMES.TXT ================= */
fetch("names.txt")
  .then(res => res.text())
  .then(text => {
    names = text
      .split("\n")
      .map(n => n.trim())
      .filter(n => n !== "");

    wheelNames = pickUnique(Math.min(20, names.length));
    drawWheel();
  });

/* ================= WHEEL ================= */
function drawWheel(rotation = 0) {
  ctx.clearRect(0,0,500,500);
  ctx.save();
  ctx.translate(250,250);
  ctx.rotate(rotation);

  const arc = (2*Math.PI) / wheelNames.length;

  for (let i=0;i<wheelNames.length;i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,200,i*arc,(i+1)*arc);
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.strokeStyle="#333";
    ctx.stroke();

    ctx.save();
    ctx.rotate(i*arc + arc/2);
    ctx.textAlign="right";
    ctx.fillStyle="#fff";
    ctx.font="14px sans-serif";
    ctx.fillText(wheelNames[i],185,5);
    ctx.restore();
  }

  ctx.restore();
  ctx.beginPath();
  ctx.moveTo(245,50);
  ctx.lineTo(255,50);
  ctx.lineTo(250,30);
  ctx.fill();
}

/* ================= SPIN ================= */
function spin(){
  if (names.length === 0) return;

  let count = parseInt(document.getElementById("winnerCount").value);
  if(!count || count < 1) count = 1;

  winners = pickUnique(count);
  wheelNames = pickUnique(Math.min(20, names.length));

  let spins = Math.random()*8 + 8;
  let totalRotation = spins * 2 * Math.PI;
  let start = null;
  const duration = 4000;

  function animate(t){
    if(!start) start = t;
    let progress = t - start;
    let rot = easeOut(progress, angle, totalRotation, duration);
    drawWheel(rot);

    if(progress < duration){
      requestAnimationFrame(animate);
    } else {
      angle = (angle + totalRotation) % (2*Math.PI);
      showWinners();
    }
  }
  requestAnimationFrame(animate);
}

/* ================= HELPERS ================= */
function pickUnique(count){
  let arr = [...names];
  for(let i=arr.length-1;i>0;i--){
    let j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr.slice(0, Math.min(count, arr.length));
}

function easeOut(t,b,c,d){
  t/=d; t--;
  return c*(t*t*t+1)+b;
}

/* ================= MODAL ================= */
function showWinners(){
  document.getElementById("winnerList").innerHTML =
    winners.map((w,i)=>`${i+1}. ${w}`).join("<br>");

  document.getElementById("winnerModal").style.display="flex";
  startConfetti();
}

function closeModal(){
  document.getElementById("winnerModal").style.display="none";
}

/* ================= CONFETTI ================= */
function startConfetti(){
  const c = document.getElementById("confetti");
  const ctx = c.getContext("2d");

  c.width = window.innerWidth;
  c.height = window.innerHeight;

  let conf = [];
  let cols = ["#ffbe0b","#fb5607","#ff006e","#8338ec","#3a86ff"];

  for(let i=0;i<200;i++){
    conf.push({
      x: Math.random()*c.width,
      y: Math.random()*c.height,
      r: Math.random()*6+4,
      d: Math.random()*100,
      color: cols[Math.floor(Math.random()*cols.length)]
    });
  }

  let t = 0;
  function draw(){
    ctx.clearRect(0,0,c.width,c.height);
    conf.forEach(p=>{
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x,p.y,p.r,p.r);
      p.y += Math.cos(t+p.d)+2;
      if(p.y > c.height) p.y = -10;
    });
    t += 0.05;
    requestAnimationFrame(draw);
  }
  draw();

  setTimeout(() => ctx.clearRect(0,0,c.width,c.height), 5000);
}

</script>

  <canvas id="confetti"></canvas>

</body>
</html>

