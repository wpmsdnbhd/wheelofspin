<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wheel Spinner</title>


<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* ===== PAGE ===== */
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #f5f0e1, #e8dcd5);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  color: #333;
}

/* ===== LAYOUT ===== */
.container {
  display: flex;
  gap: 40px;
  align-items: center;
}

/* ===== WHEEL ===== */
#wheelWrapper {
  position: relative;
}

canvas {
  background: transparent;
}

/* Center spin button */
#spinBtn {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90px;
  height: 90px;
  border-radius: 50%;
  border: none;
  background: #6E7F4B;
  color: white;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 6px 15px rgba(0,0,0,.25);
}

/* ===== SIDE PANEL ===== */
.panel h3 {
  margin: 0 0 10px;
  font-size: 15px;
  text-align: center;
}

.panel {
  background: #fff;          /* keeps the box visible */
  padding: 12px 14px;        /* inside spacing */
  border-radius: 14px;       /* rounded corners */
  width: 200px;              /* slimmer box */
  box-shadow: 0 8px 20px rgba(0,0,0,.12);  /* nice shadow */
}

.panel input {
  width: 90%;                /* smaller than box */
  display: block;
  margin: 6px auto;          /* center horizontally */
  padding: 7px 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 14px;
}


/* ===== POPUP ===== */
#popup {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.popupBox {
  background: white;
  padding: 20px;
  border-radius: 16px;
  width: 320px;
  max-height: 70vh;
  overflow-y: auto;
}

.popupBox h2 {
  text-align: center;
  margin-top: 0;
}

.popupBox button {
  width: 100%;
  margin-top: 12px;
  padding: 8px;
  border-radius: 8px;
  border: none;
  background: #6E7F4B;
  color: white;
  cursor: pointer;
}

.page-header {
  position: fixed;         /* keeps it at top even if page scrolls */
  top: 80px;               /* distance from top */
  left: 50%;               /* center horizontally */
  transform: translateX(-50%); /* correct horizontal centering */
  font-family: "Poppins", sans-serif;
  font-size: 40px;
  color: #6E7F4B;
  z-index: 1000;           /* above everything else */
  margin: 0;
}


</style>
</head>

<body>

<h1 class="page-header">ðŸŽ¡ Spin the Wheel - MIRAI</h1>

<div class="container">

  <div id="wheelWrapper">
    <canvas id="wheel" width="600" height="600"></canvas>
    <button id="spinBtn">SPIN</button>
  </div>

  <div class="panel">
    <h3>Settings</h3>
    <input type="file" id="fileInput" accept=".xlsx,.xls">
    <input type="number" id="winnerCount" placeholder="Total winners" value="" />
  </div>

</div>

<div id="popup">
  <div class="popupBox">
    <h2>ðŸŽ‰ Winners ðŸŽ‰</h2>
    <ol id="winnerList"></ol>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<script>


/* ===== CANVAS ===== */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

/* Softer original colors */
const colors = [
  "#8F3E3E",
  "#6E7F4B",
  "#7C8A96",
  "#C89B6A"
];

let allNames = [];
let remainingNames = [];
let displayNames = [];
let angle = 0;

/* ===== LOAD EXCEL ===== */
fileInput.onchange = e => {
  const reader = new FileReader();
  reader.onload = evt => {
    const wb = XLSX.read(evt.target.result, { type: "binary" });
    const sheet = wb.Sheets[wb.SheetNames[0]];
    allNames = XLSX.utils.sheet_to_json(sheet, { header: 1 })
      .flat()
      .filter(Boolean);

    remainingNames = [...allNames];
    updateWheelNames();
    drawWheel();
  };
  reader.readAsBinaryString(e.target.files[0]);
};

/* ===== DRAW WHEEL ===== */
function drawWheel(rotation = angle) {
  ctx.clearRect(0,0,600,600);
  ctx.save();
  ctx.translate(300,300);
  ctx.rotate(rotation);

  const arc = (2 * Math.PI) / displayNames.length;

  displayNames.forEach((name,i)=>{
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.fillStyle = colors[i % colors.length];
    ctx.arc(0,0,290,i*arc,(i+1)*arc);
    ctx.fill();

    ctx.save();
    ctx.rotate(i*arc + arc/2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "18px Poppins";   // BIGGER FONT
    ctx.fillText(name, 260, 6);  // PUSH TO EDGE
    ctx.restore();
  });

  ctx.restore();
}

/* ===== SPIN ===== */
spinBtn.onclick = () => {
  if (!remainingNames.length) return;

  const count = Math.min(+winnerCount.value, remainingNames.length);
  let winners = [];

  let spins = Math.random()*8 + 8;
  let totalRotation = spins * 2 * Math.PI;
  let start = null;
  const duration = 3500;

  function animate(t){
    if(!start) start = t;
    let progress = Math.min((t-start)/duration,1);
    angle = totalRotation * (1 - Math.pow(1-progress,3));
    drawWheel(angle);

    if(progress < 1) {
      requestAnimationFrame(animate);
    } else {
      for(let i=0;i<count;i++){
        winners.push(
          remainingNames.splice(Math.random()*remainingNames.length|0,1)[0]
        );
      }
      updateWheelNames();
      showPopup(winners);
    }
  }
  requestAnimationFrame(animate);
};

/* ===== HELPERS ===== */
function updateWheelNames(){
  displayNames = shuffle([...remainingNames]).slice(0,36);
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    let j=Math.random()*(i+1)|0;
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

/* ===== POPUP ===== */
function showPopup(winners){
  winnerList.innerHTML = winners.map(w=>`<li>${w}</li>`).join("");
  popup.style.display = "flex";
  confetti({ particleCount: 200, spread: 80 });
}

function closePopup(){
  popup.style.display = "none";
}
</script>

</body>
</html>
