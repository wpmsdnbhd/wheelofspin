<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f5f5f5; }
    canvas { margin-top: 20px; background: #fff; border-radius: 50%; }
    #winners { margin-top: 20px; font-weight: bold; font-size: 16px; max-height: 300px; overflow-y: auto; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 20px; cursor: pointer; }
  </style>
</head>
<body>

<h1>Wheel Spinner</h1>
<canvas id="wheel" width="500" height="500"></canvas>
<br>
<input type="number" id="winnerCount" placeholder="Number of winners" value="5" min="1" style="width:120px; padding:5px;">
<button onclick="spinCustomWinners()">Spin & Pick Winners</button>
<div id="winners"></div>

<script>
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
let names = [];
const colors = ["#8B0000", "#556B2F", "#708090", "#CD853F"]; 
let angle = 0; 
let winners = [];

// Load names from names.txt
fetch('names.txt')
  .then(res => res.text())
  .then(data => {
    names = data.split('\n').filter(n => n.trim() !== '');
    drawWheel();
  });

// Draw the wheel
function drawWheel(rotation = 0) {
  if (names.length === 0) return;
  const len = names.length;
  const arc = 2 * Math.PI / len;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(250, 250);
  ctx.rotate(rotation);

  for (let i = 0; i < len; i++) {
    const start = i * arc;
    const end = start + arc;

    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, 200, start, end);
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.strokeStyle = "#333";
    ctx.stroke();

    // Draw text
    ctx.save();
    ctx.rotate(start + arc/2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = Math.min(16, 200 / len) + "px sans-serif";
    ctx.fillText(names[i], 190, 5);
    ctx.restore();
  }

  // Pointer
  ctx.beginPath();
  ctx.moveTo(250-5, 50);
  ctx.lineTo(250+5, 50);
  ctx.lineTo(250, 30);
  ctx.fillStyle = "#000";
  ctx.fill();

  ctx.restore();
}

// Spin function with custom winner count
function spinCustomWinners() {
  let count = parseInt(document.getElementById("winnerCount").value);
  if (!count || count < 1) count = 5;
  if (count > names.length) count = names.length;

  winners = [];
  const shuffled = [...names].sort(() => Math.random() - 0.5);
  winners = shuffled.slice(0, count);

  let spins = Math.random() * 10 + 10;
  let totalRotation = spins * 2 * Math.PI;
  let startTime = null;
  const duration = 4000;

  function animate(timestamp) {
    if (!startTime) startTime = timestamp;
    const elapsed = timestamp - startTime;
    const rotation = easeOut(elapsed, angle, totalRotation, duration);
    drawWheel(rotation);
    if (elapsed < duration) {
      requestAnimationFrame(animate);
    } else {
      angle = (angle + totalRotation) % (2*Math.PI);
      document.getElementById("winners").innerHTML = "ðŸŽ‰ Winners:<br>" + winners.join("<br>");
    }
  }
  requestAnimationFrame(animate);
}

// easing for smooth deceleration
function easeOut(t, b, c, d) {
  t /= d;
  t--;
  return c*(t*t*t + 1) + b;
}
</script>

</body>
</html>
